## Android 性能优化之 内存泄漏

### 1.什么是内存泄漏

内存不在GC的掌控之内了，当一个对象已经不需要再使用了，本该被回收时，而有另外一个正在使用的对象持有它的引用从而就导致对象不能被回收。这种导致了本该被回收的对象不能被回收而停留在堆内存中，就产生了内存泄漏

GC回收机制：某对象不再有任何的引用的时候才会被回收

### 2.内存分配的集中策略

#### 1.静态的

静态的存储区：内存在程序编译的时候就已经分配好，这块的内存在程序的整个编译期间都一直存在
它主要存放静态数据、全局的static和一些常量

#### 2.栈

在执行函数（方法）时，函数一些内部变量的存储都可以放在栈上面创建，函数执行结束的时候这些存储单元就会被自动释放掉
栈内存运算速度很快，因为内置在处理器里面，但是容量有限

#### 3.堆

也叫动态内存分配，有的时候可以用malloc(注解1)或者new来申请分配一个内存
在C/C++可能需要自己负责释放（java里面直接依赖GC机制），java在这一块貌似程序员没有很好的方法自己去解决垃圾内存，需要的是编程的时候就要注意自己良好的编程习惯

- 区别：

- 堆是不连续的内存区域，堆空间比较灵活也特别大

- 栈式一块连续的内存区域，大小是有操作系统觉决定的

- 堆管理比较麻烦，频繁地new/remove会造成大量的内存碎片，这样就会慢慢导致效率低下

- 对于栈的话，他先进后出，进出完全不会产生碎片，运行效率高且稳定

- 成员变量全部存储在堆中（包括基本数据类型，引用及引用对象实体）---因为他们属于类，类对象最终还是要被new出来的

- 局部变量的基本数据类型和引用数据类型存储在栈中，引用的对象实体存储在堆中 ---因为他们属于方法中的变量，生命周期会随着方法一起结束

内存泄漏的例子：
单例模式导致内存对象无法释放而导致内存泄漏

传入的上下文引用生命周期与单例的声明周期不一样


注解1：malloc函数是一种分配长度为num_bytes字节的内存块的函数，可以向系统申请分配指定size个字节的内存空间。malloc的全称是memory allocation，中文叫动态内存分配，当无法知道内存具体位置的时候，想要绑定真正的内存空间，就需要用到动态的分配内存


### 完整代码点我下载[GitHub](https://github.com/CoderGuoy/Coder)

## Thank you

- 以上仅本人学习中遇到的问题，如有更多意见欢迎随时交流 [issues](https://github.com/CoderGuoy/MetalDesign/issues/1)
- email:coderguoy@gmail.com
